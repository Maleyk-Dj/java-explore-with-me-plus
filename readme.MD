# Comment Service

Микросервис для управления комментариями к событиям. Реализует полный цикл CRUD-операций с комментариями через REST API.

## Функциональность

### Основные возможности
- **Создание комментариев** - пользователи могут оставлять комментарии к опубликованным событиям
- **Редактирование и удаление** - управление собственными комментариями
- **Публичный просмотр** - фильтрация и поиск комментариев
- **Массовое удаление** - для модераторов и администраторов
- **Пагинация и сортировка** - эффективная работа с большими объемами данных

### Бизнес-правила
- Только авторизованные пользователи могут создавать комментарии
- Каждый пользователь управляет только своими комментариями
- Комментарии можно оставлять только к опубликованным событиям
- Длина комментария: 3-3000 символов

## API Endpoints

### Приватное API (для пользователей)

| Метод | Endpoint | Описание |
|-------|----------|-----------|
| `POST` | `/users/{userId}/comment?eventId={eventId}` | Создание комментария |
| `PATCH` | `/users/{userId}/comment/{commentId}` | Редактирование комментария |
| `DELETE` | `/users/{userId}/comment/{commentId}` | Удаление комментария |
| `GET` | `/users/{userId}/comment` | Получение комментариев пользователя |

### Публичное API (для гостей)

| Метод | Endpoint | Описание |
|-------|----------|-----------|
| `GET` | `/comment` | Поиск комментариев с фильтрацией |
| `GET` | `/comment/{commentId}` | Получение комментария по ID |

### Административное API

| Метод | Endpoint | Описание |
|-------|----------|-----------|
| `DELETE` | `/admin/comment` | Массовое удаление комментариев |

## Поиск и фильтрация

Параметры для `GET /comment`:

| Параметр | Тип | Описание | Валидация |
|----------|-----|-----------|-----------|
| `content` | String | Поиск по содержимому | Максимум 3000 символов |
| `userId` | Integer | Фильтр по автору | Должен быть положительным числом |
| `eventId` | Integer | Фильтр по событию | Должен быть положительным числом |
| `rangeStart` | String | Начало периода | Формат: yyyy-MM-dd HH:mm:ss.SSSSSS |
| `rangeEnd` | String | Конец периода | Формат: yyyy-MM-dd HH:mm:ss.SSSSSS |
| `from` | Integer | Смещение для пагинации | Минимум: 0 (по умолчанию: 0) |
| `size` | Integer | Размер страницы | Минимум: 1, максимум: 1000 (по умолчанию: 100) |

**Пример запроса:**

GET /comment?eventId=123&userId=456&content=текст&rangeStart=2024-01-01 00:00:00.000000&rangeEnd=2024-12-31 23:59:59.999999&from=0&size=10


## Модели данных

### CommentDto

{
  "id": 1,
  "content": "Текст комментария",
  "user": 123,
  "event": 456
}

**Валидация:**
- `id` - обязательное поле, положительное число
- `content` - обязательное поле, 3-3000 символов
- `user` - обязательное поле, положительное число
- `event` - обязательное поле, положительное число

### NewCommentDto

{
  "content": "Текст комментария длиной 3-3000 символов"
}

**Валидация:**
- `content` - обязательное поле, не пустое, 3-3000 символов

### UpdateCommentDto

{
  "content": "Обновленный текст комментария"
}

**Валидация:**
- `content` - обязательное поле, не пустое, 3-3000 символов

### DeleteCommentDto

{
  "commentsIds": [1, 2, 3]
}

**Валидация:**
- `commentsIds` - обязательное поле, не пустой список
- Каждый ID в списке - положительное число

## Валидация данных

### Правила валидации
1. **Длина комментария**: 3-3000 символов
2. **Идентификаторы**: только положительные числа
3. **Формат дат**: строго yyyy-MM-dd HH:mm:ss.SSSSSS
4. **Параметры пагинации**: 
   - `from` ≥ 0
   - `size` ≥ 1 и ≤ 1000
5. **Диапазон дат**: начало периода должно быть раньше конца

### Обработка ошибок
- **400 Bad Request** - невалидные данные
- **404 Not Found** - ресурс не найден
- **409 Conflict** - нарушение бизнес-правил
- **500 Internal Server Error** - внутренняя ошибка сервера